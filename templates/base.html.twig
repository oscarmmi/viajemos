<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        {% block stylesheets %}
            <link rel="stylesheet" href="{{ asset('librerias/bootstrap/bootstrap.min.css') }}"/>
            <link rel="stylesheet" href="{{ asset('librerias/datatable/dataTables.min.css') }}"/>
            <link rel="stylesheet" href="{{ asset('librerias/datatable/select.dataTables.min.css') }}"/>
            <link rel="stylesheet" href="{{ asset('librerias/alertify/alertify.min.css') }}"/>            
            <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
        {% endblock %}
        <title>Bienvenidos</title>        
    </head>
    <body class="container-fluid">
        <div class="row mt-5">
            <div class="col-lg-12">
                <ul class="nav nav-pills" id="myTab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="autores-tab" data-toggle="tab" href="#divAutores" 
                        role="tab" aria-controls="divAutores" aria-selected="true">Autores</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="editoriales-tab" data-toggle="tab" href="#divEditoriales" 
                        role="tab" aria-controls="divEditoriales" aria-selected="false">Editoriales</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="libros-tab" data-toggle="tab" href="#divLibros" 
                        role="tab" aria-controls="divLibros" aria-selected="false">Libros</a>
                    </li>
                </ul>                
            </div>            
        </div>
        
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="divAutores" role="tabpanel" aria-labelledby="autores-tab">
                <div class="row mt-5">
                    <input type="hidden" id="autores_id" class="autores"/>
                    <div class="col-lg-3">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1">Nombre</span>
                            </div>
                            <input type="text" class="form-control autores" placeholder="Nombre" 
                            aria-label="Nombre" aria-describedby="basic-addon1" id="autores_nombre">
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1">Apellidos</span>
                            </div>
                            <input type="text" class="form-control autores" placeholder="Apellidos" aria-label="Apellidos" aria-describedby="basic-addon1" id="autores_apellidos">
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <button type="button" class="btn btn-primary" id="btnLimpiarAutores">Limpiar</button>
                        <button type="button" class="btn btn-success" id="btnGuardarAutores">Guardar</button>
                    </div>
                    <div class="col-lg-12">
                        <table id="tablaAutores" class="table table-bordered table-striped display"></table>
                    </div>
                </div>                
            </div>
            <div class="tab-pane fade" id="divEditoriales" role="tabpanel" aria-labelledby="editoriales-tab">
                <div class="row mt-5">
                    <input type="hidden" id="editoriales_id" class="editoriales"/>
                    <div class="col-lg-3">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1">Nombre</span>
                            </div>
                            <input type="text" class="form-control editoriales" placeholder="Nombre" 
                            aria-label="Nombre" aria-describedby="basic-addon1" id="editoriales_nombre">
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1">Sede</span>
                            </div>
                            <input type="text" class="form-control editoriales" placeholder="Sede" aria-label="Sede" aria-describedby="basic-addon1" id="editoriales_sede">
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <button type="button" class="btn btn-primary" id="btnLimpiarEditorial">Limpiar</button>
                        <button type="button" class="btn btn-success" id="btnGuardarEditorial">Guardar</button>
                    </div>
                    <div class="col-lg-12">
                        <table id="tablaEditoriales" class="table table-bordered table-striped display"></table>
                    </div>
                </div>     
            </div>
            <div class="tab-pane fade" id="divLibros" role="tabpanel" aria-labelledby="libros-tab">
            <div class="row mt-5">
                    <input type="hidden" id="libros_isbn" class="libros"/>
                    <div class="col-lg-3">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1">Titulo</span>
                            </div>
                            <input type="text" class="form-control libros" placeholder="Titulo" 
                            aria-label="Titulo" aria-describedby="basic-addon1" id="libros_titulo">
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1">Sinopsis</span>
                            </div>
                            <input type="text" class="form-control libros" placeholder="Sinopsis" 
                            aria-label="Sinopsis" aria-describedby="basic-addon1" id="libros_sinopsis">
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1">N.Paginas</span>
                            </div>
                            <input type="text" class="form-control libros" placeholder="Numero de Paginas" 
                            aria-label="Numero de Paginas" aria-describedby="basic-addon1" id="libros_n_paginas">
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <select class="form-control libros"  id="libros_editoriales_id" title="Seleccione una Editorial" placeholder="Seleccione una Editorial">                            
                        <option value="">Seleccione una Editorial</option>
                            {% for editorial in editoriales %}
                                <option value="{{editorial.id}}">{{editorial.nombre}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-lg-6">
                        <button type="button" class="btn btn-primary" id="btnLimpiarLibro">Limpiar</button>
                        <button type="button" class="btn btn-success" id="btnGuardarLibro">Guardar</button>
                    </div>
                </div>   
                <div class="row mt-5">
                    <div class="col-lg-12">
                        <table id="tablaLibros" class="table table-bordered table-striped display"></table>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal" tabindex="-1" role="dialog" id="modalAutoresRelacionados">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Autores Relacionados con el Libro Actual</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row mt-5">
                        <input type="hidden" id="relacionados_isbn" class="relacionados"/>
                        <div class="col-lg-3">
                            <select class="form-control relacionados"  id="relacionados_autores_id" title="Seleccione un Autor" placeholder="Seleccione un Autor">                            
                            <option value="">Seleccione un Autor</option>
                            </select>
                        </div>
                        <div class="col-lg-9">
                            <button type="button" class="btn btn-success" id="btnRelacionarAutor">Agregar Autor</button>
                        </div>
                        <div class="col-lg-12 mt-3">
                            <table id="tablaAutoresRelacionados" class="table table-bordered table-striped display"></table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                </div>
                </div>
            </div>
        </div>
        
        
        {% block javascripts %}
            <script src="{{ asset('librerias/jquery/jquery-3.5.1.min.js') }}" type="text/javascript"></script>
            <script src="{{ asset('librerias/datatable/dataTables.min.js') }}" type="text/javascript"></script>
            <script src="{{ asset('librerias/datatable/dataTables.select.min.js') }}" type="text/javascript"></script>
            <script src="{{ asset('librerias/bootstrap/bootstrap.min.js') }}" type="text/javascript"></script>            
            <script src="{{ asset('librerias/alertify/alertify.min.js') }}" type="text/javascript"></script>            
            <script type="text/javascript">            

                $(document).ready(function() {
                    $("#autores-tab").click(function(){
                        $(".autores").val("");
                        buscarAutores();
                    });
                    $("#editoriales-tab").click(function(){
                        $(".editoriales").val("");
                        buscarEditoriales();                        
                    });
                    $("#libros-tab").click(function(){
                        $(".libros").val("");
                        buscarLibros();                        
                    });
                    $("#btnRelacionarAutor").click(relacionarAutores);
                    $("#btnGuardarEditorial").click(guardarEditorial);
                    $("#btnGuardarAutores").click(guardarAutores); 
                    $("#btnGuardarLibro").click(guardarLibros);
                    $("#btnLimpiarEditorial").click(function(){
                        $(".editoriales").val("");
                    });
                    $("#btnLimpiarAutores").click(function(){
                        $(".autores").val("");
                    });    
                    $("#btnLimpiarLibro").click(function(){
                        $(".libros").val("");
                    });     
                    $("#autores-tab").click();
                });   

                function relacionarAutores(){
                    let isbn=$("#relacionados_isbn").val();
                    if(!isbn){
                        alertify.error("- El libro seleccionado no es válido");
                        return;
                    }
                    let autores_id=$("#relacionados_autores_id").val();
                    if(!autores_id){
                        alertify.error("- Debe seleccionar un autor");
                        return;
                    }
                    $.ajax({
                        url: '{{ (path('guardarautoresrelacionados')) }}',
                        data: {
                            isbn, 
                            autores_id
                        }, 
                        type: 'POST',
                        dataType: 'json',
                        success: function (respuesta) {
                            recargarSelectAutoresRelacionados(respuesta.relacionados);
                            cargarTablaAutoresRelacionados(respuesta.relacionados);
                        }
                    }); 
                }

                function recargarSelectAutoresRelacionados(relacionados){
                    let autoresActuales=$("#tablaAutores").dataTable().fnGetData();
                    let autoresRelacionados=[];
                    for (const a in relacionados) {
                        autoresRelacionados.push(parseInt(relacionados[a]['autores_id']));
                    }                            
                    let html="<option value=''>Seleccione un Autor</option>";
                    for (const a in autoresActuales) {
                        if(autoresRelacionados.indexOf(parseInt(autoresActuales[a]['id']))==-1){
                            html+="<option value="+autoresActuales[a]['id']+">"+autoresActuales[a]['nombre']+"</option>";
                        }                                
                    }
                    $("#relacionados_autores_id").html(html);
                }

                function mostrarAutoresRelacionadosLibro(isbn){
                    $("#modalAutoresRelacionados").modal('show');
                    $("#relacionados_isbn").val(isbn);
                    buscarAutoresRelacionados(isbn);                    
                }

                function buscarAutoresRelacionados(isbn){
                    $.ajax({
                        url: '{{ (path('buscarautoresrelacionados')) }}',
                        data: {
                            isbn
                        }, 
                        type: 'POST',
                        dataType: 'json',
                        success: function (respuesta) {
                            recargarSelectAutoresRelacionados(respuesta.relacionados);
                            cargarTablaAutoresRelacionados(respuesta.relacionados);
                        }
                    }); 
                }
                
                function cargarTablaAutoresRelacionados(datos){
                    let tabla = $('#tablaAutoresRelacionados').DataTable({
                        paging: 'numbers',
                        bFilter: false,
                        destroy: true,
                        select: true,
                        dom: 'T<"clear">lfrtip', // Permite cargar la herramienta tableTools
                        tableTools: {
                            aButtons: [],
                            sRowSelect: "single"
                        },
                        data: datos,
                        columns: [
                            {
                                data: 'nombre',
                                title: 'Nombre',
                                className: 'text-capitalize'
                            },
                            {
                                data: 'apellidos',
                                title: 'Apellidos',
                                className: 'text-capitalize'
                            },
                            {
                                data: 'id',
                                title: 'Eliminar',
                                className: 'text-capitalize dt-body-center',
                                render: function (data, type, full, meta) {
                                    return '<a style="cursor:pointer;" onclick="eliminarAutorRelacionado(event);" title="Eliminar este Registro"><i class="fa fa-times  text-danger"></i></a>';
                                }
                            }
                        ]
                    });                
                }

                function eliminarAutorRelacionado(e){
                    var row = $(e.target).parent().parent().parent();
                    var oRow = $('#tablaAutoresRelacionados').DataTable().row(row).data();
                    alertify.confirm(
                        'Esta seguro de eliminar este registro? ',
                        function () {
                            $.ajax({
                                url: '{{ (path('eliminarautorrelacionado')) }}',
                                data: {
                                    isbn:oRow.libros_isbn, 
                                    id:oRow.id
                                }, 
                                type: 'POST',
                                dataType: 'json',
                                success: function (respuesta) {
                                    if(parseInt(respuesta.estado)){
                                        alertify.success("- El registro fue eliminado exitosamente");
                                        $(".relacionados").val("");
                                        recargarSelectAutoresRelacionados(respuesta.relacionados);
                                        cargarTablaAutoresRelacionados(respuesta.relacionados);
                                        return;
                                    }                 
                                    alertify.error(respuesta.mensaje);
                                }
                            }); 
                        }
                    );
                }

                function cargarSelectEditorialesLibros(editoriales){
                    let html="<option value=''>Seleccione una Editorial</option>";
                    for (const a in editoriales) {
                        html+="<option value="+editoriales[a]['id']+">"+editoriales[a]['nombre']+"</option>";
                    }
                    $("#libros_editoriales_id").html(html);
                }

                function guardarLibros(){
                    let ISBN=$("#libros_isbn").val();             
                    let titulo=$("#libros_titulo").val();
                    if(!titulo){
                        alertify.error('- El titulo del libro no puede estar vacío');
                        return;
                    }
                    let sinopsis=$("#libros_sinopsis").val();
                    if(!sinopsis){
                        alertify.error('- La sinopsis del libro no puede estar vacío');
                        return;
                    }
                    let n_paginas=$("#libros_n_paginas").val();
                    if(!n_paginas){
                        alertify.error('- El numero de paginas ingresado no puede estar vacío');
                        return;
                    }
                    let editorial_id=$("#libros_editoriales_id").val();
                    if(!editorial_id){
                        alertify.error('- Debe seleccionar una editorial');
                        return;
                    }
                    $.ajax({
                        url: '{{ (path('guardarlibro')) }}',
                        data: {
                            ISBN, 
                            titulo,
                            sinopsis, 
                            n_paginas,
                            editorial_id
                        }, 
                        type: 'POST',
                        dataType: 'json',
                        success: function (respuesta) {
                            alertify.success('- El libro fue guardado exitosamente');
                            $(".libros").val("");
                            buscarLibros(respuesta.libros);     
                        }
                    }); 
                }
                
                function buscarLibros(datos=[]){
                    if(parseInt(datos.length)){
                        cargarTablaLibros(datos);
                        return;
                    }
                    $.ajax({
                        url: '{{ (path('buscarlibros')) }}',
                        data: {}, 
                        type: 'POST',
                        dataType: 'json',
                        success: function (respuesta) {
                            cargarTablaLibros(respuesta.libros);
                        }
                    }); 
                }

                function cargarTablaLibros(datos){
                    if (!parseInt(datos.length)) {
                        datos = [];
                    }
                    let tabla = $('#tablaLibros').DataTable({
                        paging: 'numbers',
                        bFilter: false,
                        destroy: true,
                        select: true,
                        dom: 'T<"clear">lfrtip', // Permite cargar la herramienta tableTools
                        tableTools: {
                            aButtons: [],
                            sRowSelect: "single"
                        },
                        data: datos,
                        columns: [
                            {
                                data: 'editorial',
                                title: 'Editorial',
                                className: 'text-capitalize'
                            },
                            {
                                data: 'titulo',
                                title: 'Titulo',
                                className: 'text-capitalize'
                            },
                            {
                                data: 'sinopsis',
                                title: 'Sinopsis',
                                className: 'text-capitalize'
                            },
                            {
                                data: 'n_paginas',
                                title: 'Número de Paginas',
                                className: 'text-capitalize'
                            },
                            {
                                data: 'isbn',
                                title: 'Eliminar',
                                className: 'text-capitalize dt-body-center',
                                render: function (data, type, full, meta) {
                                    return '<a style="cursor:pointer;" onclick="eliminarLibro('+data+');" title="Eliminar este Registro"><i class="fa fa-times  text-danger"></i></a>';
                                }
                            },
                            {
                                data: 'isbn',
                                title: 'Editar',
                                className: 'text-capitalize dt-body-center',
                                render: function (data, type, full, meta) {
                                    return '<a style="cursor:pointer;" onclick="editarLibro(event);" title="Editar este Registro"><i class="fa fa-pencil text-primary"></i></a>';
                                }
                            },
                            {
                                data: 'isbn',
                                title: 'Autores',
                                className: 'text-capitalize dt-body-center',
                                render: function (data, type, full, meta) {
                                    return '<a style="cursor:pointer;" onclick="mostrarAutoresRelacionadosLibro('+data+');" title="Mostrar Autores relacionados con el Libro"><i class="fa fa-bars text-success"></i></a>';
                                }
                            }
                        ]
                    });                
                }

                function eliminarLibro(isbn){
                    alertify.confirm(
                        'Esta seguro de eliminar este registro? ',
                        function () {
                            $.ajax({
                                url: '{{ (path('eliminarlibro')) }}',
                                data: {
                                    isbn
                                }, 
                                type: 'POST',
                                dataType: 'json',
                                success: function (respuesta) {
                                    if(parseInt(respuesta.estado)){
                                        alertify.success("- El registro fue eliminado exitosamente");
                                        $(".libros").val("");
                                        buscarLibros(respuesta.libros);  
                                        return;
                                    }                 
                                    alertify.error(respuesta.mensaje);
                                }
                            }); 
                        }
                    );
                }

                function editarLibro(e){
                    var row = $(e.target).parent().parent().parent();
                    var oRow = $('#tablaLibros').DataTable().row(row).data();
                    alertify.confirm(
                        'Esta seguro de cargar este registro para editarlo? ',
                        function () {
                            for (const a in oRow) {
                                $("#libros_"+a).val(oRow[a]);
                            }
                        }
                    );
                }

                function guardarAutores(){
                    let id=$("#autores_id").val();             
                    let nombre=$("#autores_nombre").val();
                    if(!nombre){
                        alertify.error('- El nombre del autor no puede estar vacío');
                        return;
                    }
                    let apellidos=$("#autores_apellidos").val();
                    if(!apellidos){
                        alertify.error('- Los apellidos del autor no pueden estar vacíos');
                        return;
                    }
                    $.ajax({
                        url: '{{ (path('guardarautor')) }}',
                        data: {
                            id, 
                            nombre,
                            apellidos
                        }, 
                        type: 'POST',
                        dataType: 'json',
                        success: function (respuesta) {
                            alertify.success('- El autor fue guardada exitosamente');
                            $(".autores").val("");
                            buscarAutores(respuesta.autores);     
                        }
                    }); 
                }

                function buscarEditoriales(datos=[]){
                    if(parseInt(datos.length)){
                        cargarTablaEditoriales(datos);
                        return;
                    }
                    $.ajax({
                        url: '{{ (path('buscareditorial')) }}',
                        data: {}, 
                        type: 'POST',
                        dataType: 'json',
                        success: function (respuesta) {
                            cargarTablaEditoriales(respuesta.editoriales);
                        }
                    }); 
                }

                function buscarAutores(datos=[]){
                    if(parseInt(datos.length)){
                        cargarTablaAutores(datos);
                        return;
                    }
                    $.ajax({
                        url: '{{ (path('buscarautores')) }}',
                        data: {}, 
                        type: 'POST',
                        dataType: 'json',
                        success: function (respuesta) {
                            cargarTablaAutores(respuesta.autores);
                        }
                    }); 
                }

                function cargarTablaEditoriales(datos){
                    if (!parseInt(datos.length)) {
                        datos = [];
                    }
                    let tabla = $('#tablaEditoriales').DataTable({
                        paging: 'numbers',
                        bFilter: false,
                        destroy: true,
                        select: true,
                        dom: 'T<"clear">lfrtip', // Permite cargar la herramienta tableTools
                        tableTools: {
                            aButtons: [],
                            sRowSelect: "single"
                        },
                        data: datos,
                        columns: [
                            {
                                data: 'nombre',
                                title: 'Nombre',
                                className: 'text-capitalize'
                            },
                            {
                                data: 'sede',
                                title: 'Sede',
                                className: 'text-capitalize'
                            },
                            {
                                data: 'id',
                                title: 'Eliminar',
                                className: 'text-capitalize dt-body-center',
                                render: function (data, type, full, meta) {
                                    return '<a style="cursor:pointer;" onclick="eliminarEditorial('+data+');" title="Eliminar este Registro"><i class="fa fa-times  text-danger"></i></a>';
                                }
                            },
                            {
                                data: 'id',
                                title: 'Editar',
                                className: 'text-capitalize dt-body-center',
                                render: function (data, type, full, meta) {
                                    return '<a style="cursor:pointer;" onclick="editarEditorial(event);" title="Editar este Registro"><i class="fa fa-pencil text-primary"></i></a>';
                                }
                            }
                        ]
                    });                
                }

                function editarEditorial(e){                    
                    var row = $(e.target).parent().parent().parent();
                    var oRow = $('#tablaEditoriales').DataTable().row(row).data();
                    alertify.confirm(
                        'Esta seguro de cargar este registro para editarlo? ',
                        function () {
                            for (const a in oRow) {
                                $("#editoriales_"+a).val(oRow[a]);
                            }
                        }
                    );
                }

                function eliminarEditorial(id){
                    alertify.confirm(
                        'Esta seguro de eliminar este registro? ',
                        function () {
                            $.ajax({
                                url: '{{ (path('eliminareditorial')) }}',
                                data: {
                                    id
                                }, 
                                type: 'POST',
                                dataType: 'json',
                                success: function (respuesta) {
                                    if(parseInt(respuesta.estado)){
                                        alertify.success('- La editorial fue eliminada exitosamente');
                                        buscarEditoriales(respuesta.editoriales);    
                                        return;
                                    }                 
                                    alertify.error(respuesta.mensaje);
                                }
                            }); 
                        }
                    );
                }

                function guardarEditorial(){    
                    let id=$("#editoriales_id").val();             
                    let nombre=$("#editoriales_nombre").val();
                    if(!nombre){
                        alertify.error('- El nombre del editor no puede estar vacío');
                        return;
                    }
                    let sede=$("#editoriales_sede").val();
                    if(!sede){
                        alertify.error('- La sede del editor no puede estar vacío');
                        return;
                    }
                    $.ajax({
                        url: '{{ (path('guardareditorial')) }}',
                        data: {
                            id, 
                            nombre,
                            sede
                        }, 
                        type: 'POST',
                        dataType: 'json',
                        success: function (respuesta) {
                            alertify.success('- La editorial fue guardada exitosamente');
                            $(".editoriales").val("");
                            cargarSelectEditorialesLibros(respuesta.editoriales);
                            buscarEditoriales(respuesta.editoriales);     
                        }
                    }); 
                }

                function cargarTablaAutores(datos){
                    if (!parseInt(datos.length)) {
                        datos = [];
                    }
                    let tabla = $('#tablaAutores').DataTable({
                        paging: 'numbers',
                        bFilter: false,
                        destroy: true,
                        select: true,
                        dom: 'T<"clear">lfrtip', // Permite cargar la herramienta tableTools
                        tableTools: {
                            aButtons: [],
                            sRowSelect: "single",
                            "fnRowSelected": function () {
                                console.info('asdasdasd');
                            }
                        },
                        data: datos,
                        columns: [
                            {
                                data: 'nombre',
                                title: 'Nombre',
                                className: 'text-capitalize'
                            },
                            {
                                data: 'apellidos',
                                title: 'Apellidos',
                                className: 'text-capitalize'
                            },
                            {
                                data: 'id',
                                title: 'Eliminar',
                                className: 'text-capitalize dt-body-center',
                                render: function (data, type, full, meta) {
                                    return '<a style="cursor:pointer;" onclick="eliminarAutor('+data+');" title="Eliminar este Registro"><i class="fa fa-times  text-danger"></i></a>';
                                }
                            },
                            {
                                data: 'id',
                                title: 'Editar',
                                className: 'text-capitalize dt-body-center',
                                render: function (data, type, full, meta) {
                                    return '<a style="cursor:pointer;" onclick="editarAutor(event);" title="Editar este Registro"><i class="fa fa-pencil text-primary"></i></a>';
                                }
                            }
                        ]
                    });
                }

                function editarAutor(e){                    
                    var row = $(e.target).parent().parent().parent();
                    var oRow = $('#tablaAutores').DataTable().row(row).data();
                    alertify.confirm(
                        'Esta seguro de cargar este registro para editarlo? ',
                        function () {
                            for (const a in oRow) {
                                $("#autores_"+a).val(oRow[a]);
                            }
                        }
                    );
                }

                function eliminarAutor(id){
                    alertify.confirm(
                        'Esta seguro de eliminar este registro? ',
                        function () {
                            $.ajax({
                                url: '{{ (path('eliminarautor')) }}',
                                data: {
                                    id
                                }, 
                                type: 'POST',
                                dataType: 'json',
                                success: function (respuesta) {
                                    if(parseInt(respuesta.estado)){
                                        alertify.success('- El autor fue eliminado exitosamente');
                                        buscarAutores(respuesta.autores);    
                                        return;
                                    }                 
                                    alertify.error(respuesta.mensaje);
                                }
                            }); 
                        }
                    );
                }
            </script>            
        {% endblock %}
    </body>
</html>
